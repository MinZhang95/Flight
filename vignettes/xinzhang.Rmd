---
title: "FlightScanner: Find the best flight for you!"
output: 
    rmarkdown::html_vignette:
       
author: Yang Qiao, Dapeng Hu, Min Zhang, Xin Zhang and Zerui Zhang
date: "5/7/2019"
vignette: >
  %\VignetteIndexEntry{FlightScanner}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include=FALSE, message=FALSE}
library(dplyr)
library(httr)
```
## Introduction

(a paragraph to introduce the motivation and what we want to do,)

Finding the cheapest flight from point A to point B can be a headache for most of us, especially with other multiple constraints, such as duration, departure and arrival time, layover, etc. The flight searching engines do not provide detailed enough filters for those “picky” customers, and it’s also time consuming to constantly check the flight information. Our project (R package) allows us to scrape information from Skyscanner API, and keep track of that per unit time. The functions in our package also enable us to filter and sort the available flights based on customized constraints. Outcomes are presented with both text and user-friendly figures. Finally, we build a Shiny web page to make flight searching process easy and fun.


```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.align = "center"
)
```

## Getting Started

(introdue how to install our package and the api our package based on)

```{r}
library(flightscanner)
```

(introduce the dataset Airport in our package and show some plots and tables)

### Setup option 1: keychecking.R

To explore the features of our package, the API key is necessary. After attaching Flightscanner, the following function will be triggered if the API key is not provided. 
```r
flightscanner::apiCheckKey()
```

This function is based on the R function **'onAttach'**. Thus, it will be called with
```r
library(flightscanner)
```
but NOT run with
```r
flightscanner::some_function
```

Two questions will be posted for users to easily setup the API:
```r
API key is required!
Please follow the instructions to get the key:
1. Browse and login:  https://rapidapi.com/skyscanner/api/skyscanner-flight-search 
   Do you want to visit this website (1 for YES; 0 for NO)?
   
2. Copy the value of X-RapidAPI-Key in Header Parameters.
   Paste your key (without quote):
   
```
If the users enter "1" for the first question, the webpage of Rapid API will be opened and users can find the API key in the right panel(See the below figure); then users can paste the key for the second question and the API option will be automatically setup. 

```{r, out.width='100%', echo=FALSE, eval=TRUE}
knitr::include_graphics('APIwebpage.JPG')
```

Some messages will be posted to show whether the API setup is successful or not. If the key is invalid or the network is unconnected, it will show that
```r
Check your key or network connection. And use function `apiSetKey` to set key later.
```
If it successed, the welcome message will be shown:
```r
Welcome to FlightScanner!
```
The API key will be stored into "APIkey.txt" under the current working directory

### Setup option 2: setAPI.R

In addition, the users can reset the API key globally with the function 'apiSetKey'
```r
flightscanner::apiSetKey("YOUR KEY")
```
However, this function will NOT generate or rewrite 'APIkey.txt' under the current working directory.

To get the global API, the function 'apiGetKey' can be adopted:
```r
fligthscanner::apiGetKey()
```
This function will return the key if it has been set, otherwise 'NULL'.


## Main Functions

### Download data with API

### Data Processing 

### Data Storage

## Automatical Download Data

The **flightscanner** is a 'mature' paakage, and it can download the flight data by itself. Based on the package **'cronR'**, we make the function **'cron_create'**. 

The following arguments are required for **'cron_create'**:  
- origin: The origin place;  
- destination: The destination;  
- startDate: The leaving date;  
- returnDate: The return date (default is 'NULL');  
- frequency: How frequent the auto-searching is. It could be "minutely", "hourly", "daily" or any time period based on cronR's syntax.

We give some examples here:
```r
cron_create("SFO", "LHR", "2019-07-01", frequency = "daily", at = "3AM")
cron_create("SFO", "LHR", "2019-07-01", "2019-07-10", frequency = "hourly")
cron_create("SFO", "LHR", "2019-07-01", frequency = "minutely")
cron_create("SFO", "LHR", "2019-07-01", frequency = "0 */2 * * *")  # every 2 hours
```
Two files will be generated:  
- log file: 'script_origin_destination_startDate_returnDate.log';  
- database: 'flight.db'.

The log file includes the searching message. For example,


In the 'flight.db', all the search results are contained.
```{r}
# connect to SQLite database
con <- dbCreateDB(dbname = "flight.db")
```




